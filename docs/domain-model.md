# Domain Model

The domain model for OffSight defines the core entities and their relationships that represent the regulatory intelligence domain. This model captures how regulatory sources are monitored, how document versions are tracked, how changes are detected and processed, and how users interact with the system to validate AI-generated insights. The domain model serves as the foundation for database design and business logic implementation.

## Entities

### Source

A **Source** represents a configured regulatory source that OffSight monitors for changes. This could be a URL to a specific regulation page, an API endpoint, or any other publicly accessible regulatory document location.

**Key Attributes:**
- `id` - Unique identifier
- `name` - Human-readable name for the source (e.g., "Offshore Wind Safety Regulations")
- `url` - The URL or endpoint where the regulatory document is located
- `description` - Optional description of what this source monitors
- `enabled` - Boolean flag indicating whether the source is actively being monitored
- `created_at` - Timestamp when the source was first configured
- `updated_at` - Timestamp when the source configuration was last modified

**Relationships:**
- One Source has many RegulationDocuments (a source can produce multiple document versions over time)

### RegulationDocument

A **RegulationDocument** represents a snapshot of a regulatory document retrieved from a Source at a specific point in time. Each time a source is checked, a new RegulationDocument version may be created if the content has changed.

**Key Attributes:**
- `id` - Unique identifier
- `source_id` - Reference to the Source this document belongs to
- `version` - Version number or identifier for this document snapshot
- `content` - The raw content of the document (HTML, text, or structured data)
- `content_hash` - Hash of the content used for change detection
- `retrieved_at` - Timestamp when this document version was retrieved
- `url` - The specific URL from which this document was retrieved (may differ from source URL if redirected)
- `metadata` - Additional metadata about the document (e.g., publication date, document type)

**Relationships:**
- Many RegulationDocuments belong to one Source
- One RegulationDocument can be the "previous version" for many RegulationChanges (when it is compared to a newer version)
- One RegulationDocument can be the "new version" for many RegulationChanges (when it is compared to an older version)

### RegulationChange

A **RegulationChange** represents a detected change between two versions of a RegulationDocument. It contains the computed difference, AI-generated summary, and classification information.

**Key Attributes:**
- `id` - Unique identifier
- `previous_document_id` - Reference to the previous RegulationDocument version
- `new_document_id` - Reference to the new RegulationDocument version
- `diff_content` - The computed difference between the two document versions
- `ai_summary` - Human-readable summary of the change generated by the AI service
- `category_id` - Reference to the Category that classifies this change
- `detected_at` - Timestamp when the change was detected
- `status` - Status of the change (e.g., "pending", "validated", "rejected")

**Relationships:**
- One RegulationChange references two RegulationDocuments (previous and new versions)
- One RegulationChange belongs to one Category
- One RegulationChange can have many ValidationRecords (users can validate or re-validate changes)

### Category

A **Category** represents a predefined classification category for regulatory changes. Categories help users understand the impact area of a change.

**Key Attributes:**
- `id` - Unique identifier
- `name` - Name of the category (e.g., "Grid Connection", "Safety and Health", "Environment", "Certification/Documentation", "Other")
- `description` - Optional description of what types of changes belong to this category
- `color` - Optional color code for UI display purposes

**Relationships:**
- One Category has many RegulationChanges (multiple changes can be classified under the same category)

### User

A **User** represents a person who interacts with OffSight to view, validate, or manage regulatory changes.

**Key Attributes:**
- `id` - Unique identifier
- `username` - Unique username for authentication
- `email` - User's email address
- `full_name` - User's full name
- `role` - User role (e.g., "viewer", "validator", "admin")
- `created_at` - Timestamp when the user account was created
- `last_login_at` - Timestamp of the user's last login

**Relationships:**
- One User can create many ValidationRecords (users can validate multiple changes)

### ValidationRecord

A **ValidationRecord** represents a user's validation or correction of an AI-generated summary and category for a RegulationChange. It allows users to approve, modify, or reject the AI's interpretation.

**Key Attributes:**
- `id` - Unique identifier
- `change_id` - Reference to the RegulationChange being validated
- `user_id` - Reference to the User who performed the validation
- `validated_summary` - The user-corrected or approved summary text
- `validated_category_id` - The user-corrected or approved Category
- `validation_status` - Status of validation (e.g., "approved", "corrected", "rejected")
- `notes` - Optional notes from the user explaining the validation decision
- `validated_at` - Timestamp when the validation was performed

**Relationships:**
- Many ValidationRecords belong to one RegulationChange
- Many ValidationRecords belong to one User

## Relationships (Overview)

- **Source → RegulationDocument**: One-to-many (one source produces multiple document versions)
- **RegulationDocument → RegulationChange**: Many-to-many (a document can be compared to multiple other documents, creating multiple change records)
- **RegulationChange → Category**: Many-to-one (multiple changes can share the same category)
- **RegulationChange → ValidationRecord**: One-to-many (a change can be validated multiple times by different users or at different times)
- **User → ValidationRecord**: One-to-many (a user can validate multiple changes)

## From Domain Model to Implementation

This conceptual domain model will be mapped to PostgreSQL database tables using SQLAlchemy ORM models. Each entity will become a SQLAlchemy model class with appropriate relationships defined through foreign keys and relationship attributes. The structure defined here will serve as the basis for creating UML class diagrams and Entity-Relationship (ER) diagrams in Astah, which will be included in the bachelor project report. The implementation layer will follow this model to ensure consistency between the conceptual design and the actual database schema.
